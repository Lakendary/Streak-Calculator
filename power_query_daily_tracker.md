let
    Source = Python.Execute("import requests#(lf)import pandas as pd#(lf)import json#(lf)#(lf)def fetch_notion_table_data():#(lf)    """"""#(lf)    Fetch all rows from a specific Notion table for Power BI PowerQuery#(lf)    Hardcoded with secret key and database ID for direct use in Power BI#(lf)    """"""#(lf)    #(lf)    # HARDCODED VALUES - UPDATE THESE WITH YOUR ACTUAL VALUES#(lf)    NOTION_TOKEN = """"  # Replace with your actual token#(lf)    DATABASE_ID = ""6""  # Replace with your actual database ID#(lf)    #(lf)    # Headers for Notion API#(lf)    headers = {#(lf)        ""Authorization"": f""Bearer {NOTION_TOKEN}"",#(lf)        ""Notion-Version"": ""2022-06-28"",#(lf)        ""Content-Type"": ""application/json""#(lf)    }#(lf)    #(lf)    def query_database(database_id):#(lf)        """"""Query the Notion database and get all results""""""#(lf)        url = f""https://api.notion.com/v1/databases/{database_id}/query""#(lf)        results = []#(lf)        next_cursor = None#(lf)        #(lf)        while True:#(lf)            payload = {}#(lf)            if next_cursor:#(lf)                payload[""start_cursor""] = next_cursor#(lf)            #(lf)            response = requests.post(url, json=payload, headers=headers)#(lf)            #(lf)            if response.status_code != 200:#(lf)                raise Exception(f'Error fetching data: {response.status_code} - {response.text}')#(lf)            #(lf)            response_json = response.json()#(lf)            results.extend(response_json[""results""])#(lf)            next_cursor = response_json.get(""next_cursor"")#(lf)            #(lf)            if not next_cursor:#(lf)                break#(lf)        #(lf)        return {""results"": results}#(lf)    #(lf)    def get_column_titles(data_json):#(lf)        """"""Extract column titles from the first record""""""#(lf)        if not data_json[""results""]:#(lf)            return []#(lf)        return list(data_json[""results""][0][""properties""].keys())#(lf)    #(lf)    def get_column_types(data_json, columns_title):#(lf)        """"""Extract column types for proper data processing""""""#(lf)        if not data_json[""results""]:#(lf)            return {}#(lf)        #(lf)        type_data = {}#(lf)        for title in columns_title:#(lf)            type_data[title] = data_json[""results""][0][""properties""][title][""type""]#(lf)        return type_data#(lf)    #(lf)    def extract_table_data(data_json, columns_type):#(lf)        """"""Extract and format table data based on column types""""""#(lf)        table_data = {}#(lf)        #(lf)        for column_name, column_type in columns_type.items():#(lf)            if column_type in [""checkbox"", ""number"", ""email"", ""phone_number""]:#(lf)                table_data[column_name] = [#(lf)                    record[""properties""][column_name][column_type]#(lf)                    if record[""properties""][column_name][column_type] is not None#(lf)                    else """"#(lf)                    for record in data_json[""results""]#(lf)                ]#(lf)            #(lf)            elif column_type == ""date"":#(lf)                table_data[column_name] = [#(lf)                    record[""properties""][column_name][""date""][""start""]#(lf)                    if record[""properties""][column_name][""date""]#(lf)                    else """"#(lf)                    for record in data_json[""results""]#(lf)                ]#(lf)            #(lf)            elif column_type in [""rich_text"", ""title""]:#(lf)                table_data[column_name] = [#(lf)                    record[""properties""][column_name][column_type][0][""plain_text""]#(lf)                    if record[""properties""][column_name][column_type]#(lf)                    else """"#(lf)                    for record in data_json[""results""]#(lf)                ]#(lf)            #(lf)            elif column_type == ""select"":#(lf)                table_data[column_name] = [#(lf)                    record[""properties""][column_name][column_type][""name""]#(lf)                    if record[""properties""][column_name][column_type]#(lf)                    else """"#(lf)                    for record in data_json[""results""]#(lf)                ]#(lf)            #(lf)            elif column_type == ""multi_select"":#(lf)                table_data[column_name] = [#(lf)                    [option[""name""] for option in record[""properties""][column_name][column_type]]#(lf)                    if record[""properties""][column_name][column_type]#(lf)                    else []#(lf)                    for record in data_json[""results""]#(lf)                ]#(lf)            #(lf)            elif column_type == ""files"":#(lf)                table_data[f""{column_name}_FileName""] = [#(lf)                    record[""properties""][column_name][column_type][0][""name""]#(lf)                    if record[""properties""][column_name][column_type]#(lf)                    else """"#(lf)                    for record in data_json[""results""]#(lf)                ]#(lf)                table_data[f""{column_name}_FileUrl""] = [#(lf)                    record[""properties""][column_name][column_type][0][""file""][""url""]#(lf)                    if record[""properties""][column_name][column_type]#(lf)                    else """"#(lf)                    for record in data_json[""results""]#(lf)                ]#(lf)            #(lf)            elif column_type == ""people"":#(lf)                table_data[f""{column_name}_Name""] = [#(lf)                    [person[""name""] for person in record[""properties""][column_name][column_type] if ""name"" in person]#(lf)                    if record[""properties""][column_name][column_type]#(lf)                    else []#(lf)                    for record in data_json[""results""]#(lf)                ]#(lf)            #(lf)            else:#(lf)                # For any other column types, try to extract as string#(lf)                table_data[column_name] = [#(lf)                    str(record[""properties""][column_name])#(lf)                    for record in data_json[""results""]#(lf)                ]#(lf)        #(lf)        return table_data#(lf)    #(lf)    try:#(lf)        # Fetch data from Notion#(lf)        print(""Fetching data from Notion..."")#(lf)        data = query_database(DATABASE_ID)#(lf)        #(lf)        if not data[""results""]:#(lf)            print(""No data found in the database."")#(lf)            return pd.DataFrame()#(lf)        #(lf)        # Extract column information#(lf)        columns_title = get_column_titles(data)#(lf)        columns_type = get_column_types(data, columns_title)#(lf)        #(lf)        # Extract and format table data#(lf)        table_data = extract_table_data(data, columns_type)#(lf)        #(lf)        # Convert to DataFrame#(lf)        df = pd.DataFrame.from_dict(table_data)#(lf)        #(lf)        print(f""Successfully fetched {len(df)} rows and {len(df.columns)} columns"")#(lf)        return df#(lf)        #(lf)    except Exception as e:#(lf)        print(f""Error: {str(e)}"")#(lf)        return pd.DataFrame()#(lf)#(lf)# Main execution#(lf)if __name__ == ""__main__"":#(lf)    # Fetch the data#(lf)    notion_data = fetch_notion_table_data()#(lf)    #(lf)    # Display basic info about the data#(lf)    if not notion_data.empty:#(lf)        print(""\nDataFrame Info:"")#(lf)        print(f""Shape: {notion_data.shape}"")#(lf)        print(f""Columns: {list(notion_data.columns)}"")#(lf)        print(""\nFirst few rows:"")#(lf)        print(notion_data.head())#(lf)        #(lf)        # Optionally save to CSV for testing#(lf)        # notion_data.to_csv(""notion_data_export.csv"", index=False)#(lf)        # print(""\nData saved to notion_data_export.csv"")#(lf)    else:#(lf)        print(""No data retrieved."")#(lf)#(lf)# For Power BI PowerQuery, you can call this function directly:#(lf)# df = fetch_notion_table_data()#(lf)"),
    notion_data1 = Source{[Name="notion_data"]}[Value],
    #"Changed Type" = Table.TransformColumnTypes(notion_data1,{{"BP Check", type text}, {"Day", type text}, {"Update Finances", type logical}, {"CC Balance Value", type number}, {"CC Balance Check", type text}, {"Up at 5", type logical}, {"Reporting", type logical}, {"Week", type text}, {"Weekly Finance Update", type logical}, {"Plan", type logical}, {"Read", type logical}, {"No Fap", type logical}, {"Journal", type logical}, {"Weekly Review", type logical}, {"Wallet Balance", type logical}, {"Trees Grown", Int64.Type}, {"Planned Meal", type text}, {"Focus Time (Mins)", Int64.Type}, {"Weekly Learning", type logical}, {"Review", type logical}, {"Bullet Journal", type logical}, {"No Soft Drink", type logical}, {"Meditate", type logical}, {"Pills", type logical}, {"Code", type logical}, {"Garden Journal", type text}, {"Shopping List", type logical}, {"Status", type text}, {"Weight", type text}, {"Strength Exercise", type logical}, {"Down by 10", type logical}, {"Date", type date}, {"Motion", type logical}, {"Blood pressure", type text}, {"Improvements", type text}, {"Water", type logical}, {"Weight Check", type text}, {"ðŸ“’ Journal Entries", type text}, {"Lunch Feedback", type text}, {"Cardio Exercise", type logical}, {"No Snacks", type logical}, {"Inbox 0", type logical}, {"Trees Died", Int64.Type}, {"Side Hustle", type logical}, {"Meal", type text}, {"Learning", type logical}, {"No Energy Drink", type logical}, {"Name", type text}}),
    #"Added Custom" = Table.AddColumn(#"Changed Type", "BP Check 2", each Text.BetweenDelimiters([BP Check], "'boolean': ", "}")),
    #"Added Custom1" = Table.AddColumn(#"Added Custom", "CC Balance Check 2", each Text.BetweenDelimiters([CC Balance Check], "'boolean': ", "}")),
    #"Added Custom2" = Table.AddColumn(#"Added Custom1", "Planned Meal 2", each Text.BetweenDelimiters([Planned Meal], "'boolean': ", "}")),
    #"Added Custom3" = Table.AddColumn(#"Added Custom2", "Garden Journal.1", each Text.BetweenDelimiters([Garden Journal], "'boolean': ", "}")),
    #"Added Custom4" = Table.AddColumn(#"Added Custom3", "Weight Check 2", each Text.BetweenDelimiters([Weight Check], "'boolean': ", "}")),
    #"Removed Columns" = Table.RemoveColumns(#"Added Custom4",{"Status", 
"BP Check", "Day", "CC Balance Check", "Week", "Planned Meal", "Garden Journal", "Weight", "Blood pressure", "Improvements", "Weight Check", "ðŸ“’ Journal Entries", "Lunch Feedback", "Meal", "Name"}),
    #"Changed Type1" = Table.TransformColumnTypes(#"Removed Columns",{{"BP Check 2", type logical}, {"CC Balance Check 2", type logical}, {"Planned Meal 2", type logical}, {"Garden Journal.1", type logical}, {"Weight Check 2", type logical}}),
    #"Renamed Columns" = Table.RenameColumns(#"Changed Type1",{{"BP Check 2", "BP Check"}, {"CC Balance Check 2", "CC Balance Check"}, {"Planned Meal 2", "Planned Meal"}, {"Garden Journal.1", "Garden Journal"}, {"Weight Check 2", "Weight Check"}}),
    #"Unpivoted Other Columns" = Table.UnpivotOtherColumns(#"Renamed Columns", {"Date"}, "Attribute", "Value"),
    #"Replaced Value" = Table.ReplaceValue(#"Unpivoted Other Columns",false,0,Replacer.ReplaceValue,{"Value"}),
    #"Replaced Value1" = Table.ReplaceValue(#"Replaced Value",true,1,Replacer.ReplaceValue,{"Value"}),
    #"Changed Type2" = Table.TransformColumnTypes(#"Replaced Value1",{{"Value", type number}}),
    #"Filtered Rows" = Table.SelectRows(#"Changed Type2", each [Date] >= #date(2025, 1, 1))
in
    #"Filtered Rows"